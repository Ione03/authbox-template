<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar with Google Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto" x-data="calendarApp()">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4 md:mb-0">My Calendar</h1>
                
                <!-- Google Auth Button -->
                <div class="flex items-center space-x-4">
                    <div x-show="!isAuthenticated" class="flex items-center">
                        <button @click="signIn()" class="flex items-center bg-white border border-gray-300 rounded-lg shadow-sm px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none">
                            <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" width="24" height="24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Sign in with Google
                        </button>
                    </div>
                    <div x-show="isAuthenticated" class="flex items-center space-x-2">
                        <span class="text-green-600"><i class="fas fa-check-circle"></i></span>
                        <span class="text-gray-700">Connected to Google Calendar</span>
                        <button @click="signOut()" class="text-red-500 hover:text-red-700 ml-2">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Calendar Section -->
            <div class="lg:w-2/3">
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <!-- Calendar Header -->
                    <div class="flex justify-between items-center p-4 border-b">
                        <button @click="previousMonth()" class="p-2 rounded-full hover:bg-gray-100">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h2 class="text-xl font-semibold text-gray-800" x-text="getMonthYear()"></h2>
                        <button @click="nextMonth()" class="p-2 rounded-full hover:bg-gray-100">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="p-4">
                        <!-- Days of Week -->
                        <div class="grid grid-cols-7 gap-1 mb-2">
                            <template x-for="day in daysOfWeek" :key="day">
                                <div class="text-center font-medium text-gray-500 py-2" x-text="day"></div>
                            </template>
                        </div>

                        <!-- Calendar Days -->
                        <div class="grid grid-cols-7 gap-1">
                            <template x-for="day in calendarDays" :key="day.date">
                                <div 
                                    class="min-h-24 p-2 border rounded-lg transition-colors"
                                    :class="{
                                        'bg-gray-50': !day.isCurrentMonth,
                                        'hover:bg-blue-50': day.isCurrentMonth,
                                        'border-blue-300 bg-blue-50': isToday(day.date)
                                    }"
                                    @click="openEventModal(day.date)"
                                >
                                    <div class="flex justify-between">
                                        <span 
                                            class="font-medium"
                                            :class="{
                                                'text-gray-400': !day.isCurrentMonth,
                                                'text-blue-600': isToday(day.date)
                                            }"
                                            x-text="day.day"
                                        ></span>
                                        <button 
                                            x-show="day.isCurrentMonth"
                                            @click.stop="openEventModal(day.date)"
                                            class="text-gray-400 hover:text-blue-500 text-sm"
                                        >
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    
                                    <!-- Events for the day -->
                                    <div class="mt-1 space-y-1">
                                        <template x-for="event in getEventsForDate(day.date)" :key="event.id">
                                            <div 
                                                class="text-xs p-1 rounded truncate cursor-pointer"
                                                :class="getEventColorClass(event)"
                                                @click.stop="openEventDetails(event)"
                                                x-text="event.title"
                                            ></div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:w-1/3">
                <!-- Upcoming Events -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Upcoming Events</h3>
                    <div class="space-y-3">
                        <template x-for="event in upcomingEvents" :key="event.id">
                            <div class="flex items-start p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" @click="openEventDetails(event)">
                                <div class="w-2 h-full rounded" :class="getEventColorClass(event, 'bg')"></div>
                                <div class="ml-3 flex-1">
                                    <div class="flex justify-between">
                                        <span class="font-medium" x-text="event.title"></span>
                                        <span class="text-xs text-gray-500" x-text="formatTime(event.start)"></span>
                                    </div>
                                    <p class="text-xs text-gray-600 mt-1" x-text="event.description || 'No description'"></p>
                                </div>
                            </div>
                        </template>
                        <div x-show="upcomingEvents.length === 0" class="text-center text-gray-500 py-4">
                            No upcoming events
                        </div>
                    </div>
                </div>

                <!-- Sync Controls -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Sync with Google Calendar</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-700">Last synced:</span>
                            <span class="text-sm text-gray-500" x-text="lastSynced || 'Never'"></span>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button 
                                @click="syncToGoogle()" 
                                :disabled="!isAuthenticated"
                                class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors"
                            >
                                <i class="fas fa-upload mr-2"></i>Push to Google
                            </button>
                            <button 
                                @click="syncFromGoogle()" 
                                :disabled="!isAuthenticated"
                                class="flex-1 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 disabled:bg-green-300 disabled:cursor-not-allowed transition-colors"
                            >
                                <i class="fas fa-download mr-2"></i>Pull from Google
                            </button>
                        </div>
                        
                        <div class="text-xs text-gray-500">
                            <i class="fas fa-info-circle mr-1"></i>
                            Sign in with Google to enable synchronization
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Event Modal -->
        <div x-show="eventModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-md" @click.stop>
                <div class="p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4" x-text="editingEvent ? 'Edit Event' : 'Add New Event'"></h3>
                    
                    <form @submit.prevent="saveEvent()">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Title</label>
                                <input 
                                    type="text" 
                                    x-model="eventForm.title"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    required
                                >
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                <textarea 
                                    x-model="eventForm.description"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows="3"
                                ></textarea>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Start Date & Time</label>
                                    <input 
                                        type="datetime-local" 
                                        x-model="eventForm.start"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                    >
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">End Date & Time</label>
                                    <input 
                                        type="datetime-local" 
                                        x-model="eventForm.end"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        required
                                    >
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Color</label>
                                <div class="flex space-x-2">
                                    <template x-for="color in eventColors" :key="color">
                                        <button 
                                            type="button"
                                            class="w-8 h-8 rounded-full border-2"
                                            :class="{
                                                'border-gray-800': eventForm.color === color,
                                                'border-transparent': eventForm.color !== color
                                            }"
                                            :style="`background-color: ${color}`"
                                            @click="eventForm.color = color"
                                        ></button>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-end space-x-3 mt-6">
                            <button 
                                type="button" 
                                @click="closeEventModal()"
                                class="px-4 py-2 text-gray-600 hover:text-gray-800"
                            >
                                Cancel
                            </button>
                            <button 
                                type="submit" 
                                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                            >
                                Save Event
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Event Details Modal -->
        <div x-show="eventDetailsModalOpen" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-md" @click.stop>
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-gray-800" x-text="selectedEvent.title"></h3>
                        <button @click="closeEventDetailsModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex items-center">
                            <i class="fas fa-calendar-day text-gray-400 mr-3"></i>
                            <span x-text="formatDateTime(selectedEvent.start) + ' - ' + formatDateTime(selectedEvent.end)"></span>
                        </div>
                        
                        <div class="flex items-start" x-show="selectedEvent.description">
                            <i class="fas fa-align-left text-gray-400 mr-3 mt-1"></i>
                            <p class="text-gray-700" x-text="selectedEvent.description"></p>
                        </div>
                        
                        <div class="flex items-center">
                            <i class="fas fa-sync-alt text-gray-400 mr-3"></i>
                            <span x-text="selectedEvent.synced ? 'Synced with Google' : 'Not synced'"></span>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button 
                            @click="deleteEvent(selectedEvent)"
                            class="px-4 py-2 text-red-600 hover:text-red-800"
                        >
                            Delete
                        </button>
                        <button 
                            @click="editEvent(selectedEvent)"
                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
                        >
                            Edit
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function calendarApp() {
            return {
                // App state
                currentDate: new Date(),
                events: [],
                isAuthenticated: false,
                lastSynced: null,
                
                // Modal states
                eventModalOpen: false,
                eventDetailsModalOpen: false,
                editingEvent: null,
                selectedEvent: {},
                
                // Event form
                eventForm: {
                    title: '',
                    description: '',
                    start: '',
                    end: '',
                    color: '#3b82f6' // blue-500
                },
                
                // Constants
                daysOfWeek: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                eventColors: ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6'],
                
                // Initialize the calendar
                init() {
                    this.loadEventsFromStorage();
                    this.setupGoogleAPI();
                },
                
                // Calendar navigation
                previousMonth() {
                    this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() - 1, 1);
                },
                
                nextMonth() {
                    this.currentDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 1);
                },
                
                // Get month and year for display
                getMonthYear() {
                    return this.currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                },
                
                // Check if a date is today
                isToday(date) {
                    const today = new Date();
                    return date.getDate() === today.getDate() && 
                           date.getMonth() === today.getMonth() && 
                           date.getFullYear() === today.getFullYear();
                },
                
                // Generate calendar days for the current month view
                get calendarDays() {
                    const year = this.currentDate.getFullYear();
                    const month = this.currentDate.getMonth();
                    
                    // First day of the month
                    const firstDay = new Date(year, month, 1);
                    // Last day of the month
                    const lastDay = new Date(year, month + 1, 0);
                    
                    // Start from the Sunday of the week containing the first day
                    const startDate = new Date(firstDay);
                    startDate.setDate(firstDay.getDate() - firstDay.getDay());
                    
                    // End at the Saturday of the week containing the last day
                    const endDate = new Date(lastDay);
                    endDate.setDate(lastDay.getDate() + (6 - lastDay.getDay()));
                    
                    const days = [];
                    const currentDate = new Date(startDate);
                    
                    while (currentDate <= endDate) {
                        days.push({
                            date: new Date(currentDate),
                            day: currentDate.getDate(),
                            isCurrentMonth: currentDate.getMonth() === month
                        });
                        currentDate.setDate(currentDate.getDate() + 1);
                    }
                    
                    return days;
                },
                
                // Get events for a specific date
                getEventsForDate(date) {
                    return this.events.filter(event => {
                        const eventDate = new Date(event.start);
                        return eventDate.getDate() === date.getDate() && 
                               eventDate.getMonth() === date.getMonth() && 
                               eventDate.getFullYear() === date.getFullYear();
                    });
                },
                
                // Get upcoming events (next 7 days)
                get upcomingEvents() {
                    const today = new Date();
                    const nextWeek = new Date(today);
                    nextWeek.setDate(today.getDate() + 7);
                    
                    return this.events
                        .filter(event => new Date(event.start) >= today && new Date(event.start) <= nextWeek)
                        .sort((a, b) => new Date(a.start) - new Date(b.start));
                },
                
                // Event color utility
                getEventColorClass(event, type = 'text') {
                    if (type === 'bg') {
                        return `bg-[${event.color}]`;
                    }
                    return `bg-[${event.color}] text-white`;
                },
                
                // Format time for display
                formatTime(dateTime) {
                    return new Date(dateTime).toLocaleTimeString('en-US', { 
                        hour: 'numeric', 
                        minute: '2-digit',
                        hour12: true 
                    });
                },
                
                // Format date and time for display
                formatDateTime(dateTime) {
                    return new Date(dateTime).toLocaleString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        hour: 'numeric', 
                        minute: '2-digit',
                        hour12: true 
                    });
                },
                
                // Event modal functions
                openEventModal(date) {
                    this.eventForm = {
                        title: '',
                        description: '',
                        start: this.formatDateTimeLocal(new Date(date)),
                        end: this.formatDateTimeLocal(new Date(date.getTime() + 60 * 60 * 1000)), // 1 hour later
                        color: '#3b82f6'
                    };
                    this.editingEvent = null;
                    this.eventModalOpen = true;
                },
                
                openEventDetails(event) {
                    this.selectedEvent = event;
                    this.eventDetailsModalOpen = true;
                },
                
                closeEventModal() {
                    this.eventModalOpen = false;
                    this.editingEvent = null;
                },
                
                closeEventDetailsModal() {
                    this.eventDetailsModalOpen = false;
                },
                
                editEvent(event) {
                    this.eventForm = {
                        title: event.title,
                        description: event.description || '',
                        start: this.formatDateTimeLocal(new Date(event.start)),
                        end: this.formatDateTimeLocal(new Date(event.end)),
                        color: event.color
                    };
                    this.editingEvent = event;
                    this.eventDetailsModalOpen = false;
                    this.eventModalOpen = true;
                },
                
                // Save event (new or edited)
                saveEvent() {
                    if (this.editingEvent) {
                        // Update existing event
                        const index = this.events.findIndex(e => e.id === this.editingEvent.id);
                        if (index !== -1) {
                            this.events[index] = {
                                ...this.editingEvent,
                                title: this.eventForm.title,
                                description: this.eventForm.description,
                                start: this.eventForm.start,
                                end: this.eventForm.end,
                                color: this.eventForm.color
                            };
                        }
                    } else {
                        // Create new event
                        const newEvent = {
                            id: Date.now().toString(),
                            title: this.eventForm.title,
                            description: this.eventForm.description,
                            start: this.eventForm.start,
                            end: this.eventForm.end,
                            color: this.eventForm.color,
                            synced: false
                        };
                        this.events.push(newEvent);
                    }
                    
                    this.saveEventsToStorage();
                    this.closeEventModal();
                },
                
                // Delete event
                deleteEvent(event) {
                    this.events = this.events.filter(e => e.id !== event.id);
                    this.saveEventsToStorage();
                    this.closeEventDetailsModal();
                },
                
                // Format date for datetime-local input
                formatDateTimeLocal(date) {
                    return new Date(date.getTime() - (date.getTimezoneOffset() * 60000))
                        .toISOString()
                        .slice(0, 16);
                },
                
                // Local storage functions
                saveEventsToStorage() {
                    localStorage.setItem('calendarEvents', JSON.stringify(this.events));
                },
                
                loadEventsFromStorage() {
                    const storedEvents = localStorage.getItem('calendarEvents');
                    if (storedEvents) {
                        this.events = JSON.parse(storedEvents);
                    }
                },
                
                // Google Calendar integration (simulated)
                setupGoogleAPI() {
                    // In a real app, you would initialize the Google API client here
                    // For this demo, we'll simulate the authentication state
                    const savedAuthState = localStorage.getItem('googleAuth');
                    if (savedAuthState) {
                        this.isAuthenticated = JSON.parse(savedAuthState);
                    }
                },
                
                signIn() {
                    // Simulate Google OAuth flow
                    setTimeout(() => {
                        this.isAuthenticated = true;
                        localStorage.setItem('googleAuth', 'true');
                        this.lastSynced = new Date().toLocaleString();
                    }, 1000);
                },
                
                signOut() {
                    this.isAuthenticated = false;
                    localStorage.setItem('googleAuth', 'false');
                },
                
                syncToGoogle() {
                    // Simulate syncing events to Google Calendar
                    this.events.forEach(event => {
                        if (!event.synced) {
                            event.synced = true;
                        }
                    });
                    
                    this.saveEventsToStorage();
                    this.lastSynced = new Date().toLocaleString();
                    
                    // Show success message
                    alert('Events successfully synced to Google Calendar!');
                },
                
                syncFromGoogle() {
                    // Simulate fetching events from Google Calendar
                    const googleEvents = [
                        {
                            id: 'google-1',
                            title: 'Meeting with Team',
                            description: 'Weekly team sync',
                            start: new Date(new Date().setDate(new Date().getDate() + 1)).toISOString(),
                            end: new Date(new Date().setDate(new Date().getDate() + 1)).toISOString(),
                            color: '#10b981',
                            synced: true
                        },
                        {
                            id: 'google-2',
                            title: 'Project Deadline',
                            description: 'Submit final project deliverables',
                            start: new Date(new Date().setDate(new Date().getDate() + 5)).toISOString(),
                            end: new Date(new Date().setDate(new Date().getDate() + 5)).toISOString(),
                            color: '#ef4444',
                            synced: true
                        }
                    ];
                    
                    // Merge with existing events, avoiding duplicates
                    googleEvents.forEach(googleEvent => {
                        if (!this.events.some(event => event.id === googleEvent.id)) {
                            this.events.push(googleEvent);
                        }
                    });
                    
                    this.saveEventsToStorage();
                    this.lastSynced = new Date().toLocaleString();
                    
                    // Show success message
                    alert('Events successfully synced from Google Calendar!');
                }
            }
        }
    </script>
</body>
</html>